<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>
        <title>Manage Groups</title>

        <!-- Bootstrap & Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
        <link rel="stylesheet" href="css/adminCss.css"/>
        <link rel="stylesheet" href="css/sidebar_header_css.css"/>
        <style>
            .btn-add-group {
                background-color: #0d6efd;
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                font-weight: 600;
                border: none;
                cursor: pointer;
            }
            .data-table-container {
                background-color: #ffffff;
                border-radius: 8px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
                overflow: hidden;
                border: 1px solid #e9eef2;
            }
            .group-table {
                width: 100%;
                border-collapse: collapse;
            }
            .group-table th {
                background-color: #f8f9fa;
                font-weight: 600;
                color: #343a40;
                padding: 12px 15px;
                text-align: left;
                border-bottom: 1px solid #dee2e6;
            }
            .group-table td {
                padding: 12px 15px;
                border-bottom: 1px solid #eee;
            }
            .action-icon {
                padding: 5px 8px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                cursor: pointer;
                font-size: 0.9em;
                margin-right: 5px;
                transition: background-color 0.2s;
            }
            .action-icon:hover {
                background-color: #f0f0f0;
            }
            .edit-icon {
                color: #0d6efd;
            }
            .delete-icon {
                color: #dc3545;
            }
   
        </style>
    </h:head>

    <h:body>

        <!-- Sticky Header -->
        <div class="sticky-header-wrapper">
            <ui:include src="/adminHeader.xhtml"/>
        </div>

        <div class="main-layout">

            <!-- Sidebar -->
            <ui:include src="sidebar.xhtml"/>

            <!-- MAIN CONTENT -->
            <div class="main-content">

                <h:form>

                    <div class="content-header">
                        <h2 class="page-title">Manage Groups</h2>

                        <h:commandButton value="+ Add Group"
                                         action="#{groupBean.resetForm}"
                                         styleClass="btn-add-group">
                            <f:ajax render="groupModalForm"
                                    onevent="function(){
                                    new bootstrap.Modal(document.getElementById('groupModal')).show();
                                    }"/>
                        </h:commandButton>
                    </div>

                    <!-- Group Table -->
                    <div class="data-table-container">

                        <h:dataTable value="#{groupBean.pagedGroups}" var="g" styleClass="group-table">

                            <!-- ID Column -->
                            <h:column>
                                <f:facet name="header">ID</f:facet>
                                    #{(groupBean.pageNumber - 1) * groupBean.pageSize + groupBean.pagedGroups.indexOf(g) + 1}
                            </h:column>

                            <!-- Group Name -->
                            <h:column>
                                <f:facet name="header">Group</f:facet>
                                    #{g.groupname}
                            </h:column>

                            <!-- Username -->
                            <h:column>
                                <f:facet name="header">Name</f:facet>
                                    #{g.username}
                            </h:column>

                            <!-- Actions -->
                            <h:column>
                                <f:facet name="header">Actions</f:facet>

                                <h:commandButton value="&#x270E;"
                                                 action="#{groupBean.editGroup(g.groupid)}"
                                                 styleClass="action-icon edit-icon"
                                                 title="Edit">
                                    <f:ajax execute="@this" render="groupModalForm"
                                            onevent="function(){
                                            new bootstrap.Modal(document.getElementById('groupModal')).show();
                                            }"/>
                                </h:commandButton>

                                <h:commandButton value="&#x1F5D1;"
                                                 action="#{groupBean.deleteGroup(g.groupid)}"
                                                 onclick="deleteConfirm(event, this)"
                                                 styleClass="action-icon delete-icon"
                                                 title="Delete"/>
                            </h:column>

                        </h:dataTable>

                        <!-- Pagination Controls -->
              
<div class="pagination-container d-flex justify-content-center mt-4">

    <ul class="premium-pagination">

        <!-- Previous -->
        <li class="#{groupBean.pageNumber == 1 ? 'disabled' : ''}">
            <h:commandLink action="#{groupBean.previousPage}">
                <f:ajax render="@form"/>
                <i class="bi bi-chevron-left"></i> 
            </h:commandLink>
        </li>

        <!-- Page Display -->
        <li class="active">
            <span>
               #{groupBean.pageNumber} / #{groupBean.totalPages}
            </span>
        </li>

        <!-- Next -->
        <li class="#{groupBean.pageNumber == groupBean.totalPages ? 'disabled' : ''}">
            <h:commandLink action="#{groupBean.nextPage}">
                <f:ajax render="@form"/>
                 <i class="bi bi-chevron-right"></i>
            </h:commandLink>
        </li>

    </ul>

</div>

                    </div>

                </h:form>

                <!-- MODAL FORM -->
                <div class="modal fade" id="groupModal">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <h:form id="groupModalForm">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <h:panelGroup rendered="#{not groupBean.editMode}">Add Group</h:panelGroup>
                                        <h:panelGroup rendered="#{groupBean.editMode}">
                                            Edit Group (ID: #{groupBean.id})
                                        </h:panelGroup>
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="FixBackdrop()"></button>
                                </div>

                                <div class="modal-body">
                                    <label>Group:</label>
                                    <h:inputText value="#{groupBean.groupname}" styleClass="form-control" required="true"/>

                                    <label class="mt-2">Name:</label>
                                    <h:inputText value="#{groupBean.username}" styleClass="form-control" required="true"/>
                                </div>

                                <div class="modal-footer">

                                    <!-- Add Group Button -->
                                    <h:panelGroup rendered="#{not groupBean.editMode}">
                                        <h:commandButton value="Add Group" styleClass="btn btn-success"
                                                         action="#{groupBean.addGroup}">
                                            <f:ajax execute="@form" render="@form"
                                                    onevent="function(){
                                                    bootstrap.Modal.getInstance(document.getElementById('groupModal')).hide();
                                                    }"/>
                                        </h:commandButton>
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="FixBackdrop()">
                                            Cancel
                                        </button>
                                    </h:panelGroup>

                                    <!-- Update Group -->
                                    <h:panelGroup rendered="#{groupBean.editMode}">
                                        <h:commandButton value="Update" styleClass="btn btn-primary"
                                                         action="#{groupBean.updateGroup}">
                                            <f:ajax execute="@form" render="@form"
                                                    onevent="function(){
                                                    bootstrap.Modal.getInstance(document.getElementById('groupModal')).hide();
                                                    }"/>
                                        </h:commandButton>

                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="FixBackdrop()">
                                            Cancel
                                        </button>
                                    </h:panelGroup>

                                </div>

                            </h:form>

                        </div>
                    </div>
                </div>

            </div>

        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    </h:body>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
                                            function deleteConfirm(event, button) {
                                                event.preventDefault();

                                                Swal.fire({
                                                    title: 'Are you sure?',
                                                    text: "This group will be permanently deleted!",
                                                    icon: 'warning',
                                                    showCancelButton: true,
                                                    confirmButtonColor: '#dc3545',
                                                    cancelButtonColor: '#6c757d',
                                                    confirmButtonText: 'Yes, delete it!',
                                                    cancelButtonText: 'Cancel'
                                                }).then((result) => {
                                                    if (result.isConfirmed) {
                                                        button.onclick = null;  // stop re-trigger
                                                        button.click();         // JSF submit
                                                    }
                                                });
                                            }
    </script>


    <script>
        function FixBackdrop() {
            document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
            document.body.classList.remove('modal-open');
            document.body.style.removeProperty('overflow');
            document.body.style.removeProperty('padding-right');
        }
    </script>
</html>
