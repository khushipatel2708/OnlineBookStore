<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <title>My Cart</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

        <style>
            body {
                background: #f8f9fa;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .cart-container {
                max-width: 900px;
                margin: 40px auto;
            }

            .cart-card {
                padding: 30px;
                border-radius: 15px;
                background: #fff;
                box-shadow: 0px 6px 20px rgba(0,0,0,0.1);
            }

            .cart-header {
                text-align: center;
                font-size: 32px;
                font-weight: 700;
                color: #333;
                margin-bottom: 25px;
            }

            .table thead {
                background-color: #f1f3f5;
                font-weight: 600;
            }

            .qty-btn {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                padding: 0;
                font-weight: bold;
            }

            .delete-btn {
                padding: 5px 10px;
                border-radius: 5px;
            }

            .charges {
                text-align: right;
                font-size: 18px;
                margin-top: 20px;
            }

            .charges b {
                font-size: 22px;
                color: #28a745;
            }

            .checkout-btn {
                width: 100%;
                padding: 12px 0;
                font-size: 18px;
                font-weight: 600;
                border-radius: 8px;
                margin-top: 20px;
            }

            .empty-message {
                text-align: center;
                font-size: 22px;
                font-weight: 600;
                color: #dc3545;
                padding: 40px 0;
            }
        </style>
    </h:head>

    <h:body>
        <div class="sticky-header-wrapper">
            <ui:include src="/header.xhtml" /> 
        </div>
        <h:form id="cartForm"> 

            <div class="cart-container">
                <div class="cart-card">

                    <div class="cart-header">My Cart</div>

                    <!-- Empty Cart -->
                    <h:panelGroup rendered="#{empty cartBean.cartItems}">
                        <div class="empty-message">
                            Your cart is empty!
                        </div>
                    </h:panelGroup>

                    <!-- Cart Table -->
                    <h:panelGroup rendered="#{not empty cartBean.cartItems}">
                        <h:dataTable value="#{cartBean.cartItems}" var="c" styleClass="table table-hover table-striped align-middle">

                            <h:column>
                                <f:facet name="header">Book Name</f:facet>
                                    #{c.bookId.bookname}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Price</f:facet>
                                ₹#{c.bookId.price}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Quantity</f:facet>
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <h:commandButton value="-" styleClass="btn btn-primary qty-btn"
                                                     action="#{cartBean.decreaseQuantity(c.id)}"
                                                     disabled="#{c.quantity le 1}">
                                        <f:ajax render="@form"/>
                                    </h:commandButton>

                                    <h:outputText value="#{c.quantity}" class="mx-2"/>

                                    <h:commandButton value="+" styleClass="btn btn-primary qty-btn"
                                                     action="#{cartBean.increaseQuantity(c.id)}"
                                                     disabled="#{c.quantity ge c.bookId.available}">
                                        <f:ajax render="@form"/>
                                    </h:commandButton>
                                </div>
                            </h:column>

                            <h:column>
                                <f:facet name="header">Stock Left</f:facet>
                                    #{c.bookId.available - c.quantity}
                            </h:column>


                            <h:column>
                                <f:facet name="header">Total</f:facet>
                                ₹#{c.bookId.price * c.quantity}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Action</f:facet>
                                <h:commandButton value="Delete" styleClass="btn btn-danger delete-btn"
                                                 action="#{cartBean.removeFromCart(c.id)}">
                                    <f:ajax render="@form"/>
                                </h:commandButton>
                            </h:column>

                        </h:dataTable>

                        <!-- Charges -->
                        <div class="charges">
                            <p>Subtotal: ₹#{cartBean.totalPrice}</p>
                            <p>Delivery Charge: ₹30</p>
                            <hr/>
                            <p>Grand Total: <b>₹#{cartBean.finalTotal}</b></p>
                        </div>

                        <!-- Checkout Button -->
                        <h:commandButton value="Confirm to Proceed" styleClass="btn btn-success checkout-btn"
                                         action="confirmOerder.jsf?faces-redirect=true"/>
                    </h:panelGroup>

                </div>
            </div>

        </h:form>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </h:body>
</html>
