<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <title>My Cart</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"/>

        <style>
            body {
                background: #f8f9fa;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            .cart-container {
                max-width: 900px;
                margin: 40px auto;
            }

            .cart-card {
                padding: 30px;
                border-radius: 15px;
                background: #fff;
                box-shadow: 0px 6px 20px rgba(0,0,0,0.1);
            }

            .cart-header {
                text-align: center;
                font-size: 32px;
                font-weight: 700;
                color: #333;
                margin-bottom: 25px;
            }

            .table thead {
                background-color: #f1f3f5;
                font-weight: 600;
            }

            .qty-btn {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                padding: 0;
                font-weight: bold;
            }

            .delete-btn {
                padding: 5px 10px;
                border-radius: 5px;
            }

            .charges {
                text-align: right;
                font-size: 18px;
                margin-top: 20px;
            }

            .charges b {
                font-size: 22px;
                color: #28a745;
            }

            .checkout-btn {
                width: 100%;
                padding: 12px 0;
                font-size: 18px;
                font-weight: 600;
                border-radius: 8px;
                margin-top: 20px;
            }

            .empty-cart-box {
                background: #ffffff;
                border-radius: 15px;

                max-width: 600px;
                margin: 40px auto;
            }

            .empty-cart-img {
                width: 160px;
                opacity: 0.85;
            }

            .empty-cart-title {
                font-size: 28px;
                font-weight: 700;
                color: #333;
            }

            .empty-cart-text {
                font-size: 18px;
                color: #777;
            }

        </style>
    </h:head>

    <h:body>
        <div class="sticky-header-wrapper">
            <ui:include src="/header.xhtml" /> 
        </div>
        <h:form id="cartForm"> 

            <div class="cart-container">
                <div class="cart-card">

                    <div class="cart-header">My Cart</div>

                    <!-- Empty Cart -->
                    <!-- Empty Cart -->
                    <h:panelGroup rendered="#{empty cartBean.cartItems}">
                        <div class="empty-cart-box text-center p-0">

                            <img src="images/cart1.png" 
                                 alt="Empty Cart"
                                 class="empty-cart-img mb-4"/>

                            <h3 class="empty-cart-title">Your Cart is Empty!</h3>
                            <p class="empty-cart-text">Looks like you haven’t added anything yet.</p>

                            <a href="UserBookList.jsf" class="btn btn-primary mt-3 px-4 py-2">
                                <i class="bi bi-shop"></i> Continue Shopping
                            </a>
                        </div>
                    </h:panelGroup>


                    <!-- Cart Table -->
                    <h:panelGroup rendered="#{not empty cartBean.cartItems}">
                        <h:dataTable value="#{cartBean.cartItems}" var="c" styleClass="table table-hover table-striped align-middle">

                            <h:column>
                                <f:facet name="header">Book Name</f:facet>
                                    #{c.bookId.bookname}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Price</f:facet>
                                ₹#{c.bookId.price}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Quantity</f:facet>
                                <div class="d-flex justify-content-center align-items-center gap-2">
                                    <h:commandButton value="-" styleClass="btn btn-primary qty-btn"
                                                     action="#{cartBean.decreaseQuantity(c.id)}"
                                                     disabled="#{c.quantity le 1}">
                                        <f:ajax render="@form"/>
                                    </h:commandButton>

                                    <h:outputText value="#{c.quantity}" class="mx-2"/>

                                    <h:commandButton value="+" styleClass="btn btn-primary qty-btn"
                                                     action="#{cartBean.increaseQuantity(c.id)}"
                                                     disabled="#{c.quantity ge c.bookId.available}">
                                        <f:ajax render="@form"/>
                                    </h:commandButton>
                                </div>
                            </h:column>

                            <h:column>
                                <f:facet name="header">Stock Left</f:facet>
                                    #{c.bookId.available - c.quantity}
                            </h:column>


                            <h:column>
                                <f:facet name="header">Total</f:facet>
                                ₹#{c.bookId.price * c.quantity}
                            </h:column>

                            <h:column>
                                <f:facet name="header">Action</f:facet>

                                <h:commandButton value="Delete"
                                                 action="#{cartBean.deleteItem(c.id)}"
                                                 onclick="deleteConfirm(event, this)"
                                                 styleClass="btn btn-danger delete-btn"
                                                 title="Delete"/>
                            </h:column>


                        </h:dataTable>

                        <!-- Charges -->
                        <div class="charges">
                            <p>Subtotal: ₹#{cartBean.totalPrice}</p>
                            <p>Delivery Charge: ₹30</p>
                            <hr/>
                            <p>Grand Total: <b>₹#{cartBean.finalTotal}</b></p>
                        </div>

                        <!-- Checkout Button -->
                        <h:commandButton value="Confirm to Proceed" styleClass="btn btn-success checkout-btn"
                                         action="confirmOerder.jsf?faces-redirect=true"/>
                    </h:panelGroup>

                </div>
            </div>

        </h:form>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    </h:body>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
                                                     function deleteConfirm(event, button) {
                                                         event.preventDefault();

                                                         Swal.fire({
                                                             title: 'Are you sure?',
                                                             text: "This item will be removed from your cart!",
                                                             icon: 'warning',
                                                             showCancelButton: true,
                                                             confirmButtonColor: '#dc3545',
                                                             cancelButtonColor: '#6c757d',
                                                             confirmButtonText: 'Yes, delete it!',
                                                             cancelButtonText: 'Cancel'
                                                         }).then((result) => {
                                                             if (result.isConfirmed) {
                                                                 button.onclick = null;  // avoid loop
                                                                 button.click();         // submit JSF action
                                                             }
                                                         });
                                                     }
    </script>


</html>
