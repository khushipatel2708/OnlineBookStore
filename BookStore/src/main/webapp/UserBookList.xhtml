<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:f="jakarta.faces.core">

    <h:head>
        <title>Books</title>

        <!-- Bootstrap -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet"/>

        <style>
            body {
                background: #f4f7fb;
                font-family: 'Segoe UI', sans-serif;
            }

            /* ======== HEADER ======== */
            .sticky-header-wrapper {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 1030;
                background-color: white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.08);
                height: 65px;
            }

            /* SEARCH BAR PREMIUM STYLE */
            .search-container {
                background: #ffffff;
                padding: 25px;
                margin-top: 90px;
                border-radius: 15px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08);
                transition: 0.25s ease;
            }

            .search-container:hover {
                box-shadow: 0 10px 28px rgba(0,0,0,0.12);
            }

            .search-container label {
                font-weight: 600;
                color: #333;
            }

            .input-group-text {
                border-radius: 6px 0 0 6px !important;
                background: #f8f9fa !important;
                border: 1px solid #ced4da !important;
            }

            .form-control {
                border-radius: 0 6px 6px 0 !important;
                padding: 10px 12px;
                border: 1px solid #ced4da !important;
            }

            .form-control:focus {
                border-color: #0d6efd !important;
                box-shadow: none !important;
            }

            /* Search  Clear button style */
            .btn-primary, .btn-secondary {
                padding: 10px 14px;
                border-radius: 6px;
                font-weight: 600;
            }

            .btn-primary {
                background: #0d6efd !important;
                border: none !important;
            }

            .btn-secondary {
                background: #6c757d !important;
                border: none !important;
            }



            /* ======== SIDEBAR ======== */
            .sidebar-card {
                background: white;
                border-radius: 14px;
                padding: 18px;
                box-shadow: 0 6px 18px rgba(0,0,0,0.06);
            }

            .list-group-item {
                padding: 10px 15px;
                border: none;
                font-weight: 500;
                color: #444;
                border-radius: 8px;
                margin-bottom: 2px;
            }

            .list-group-item:hover {
                background: #eef3ff;
            }

            .active-category {
                background: #0d6efd !important;
                color: white !important;
            }


            /* ======== BOOK CARD ======== */
            .book-card {
                border: none;
                border-radius: 14px;
                padding: 15px;
                background: white;
                box-shadow: 0 5px 18px rgba(0,0,0,0.06);
                transition: 0.25s;

                display: flex;
                flex-direction: column;   /* Stack content vertically */
                justify-content: space-between;  /* Push buttons to bottom */
                height: 420px;  /* Adjust as per your need */
            }


            .book-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            }

            .book-card img {
                border-radius: 10px;
                height: 240px;   /* Fixed height for all images */
                object-fit: cover;
                width: 100%;
            }


            .book-title {
                font-size: 1.15rem;
                font-weight: 700;
                margin-top: 10px;
            }

            .book-author {
                color: #6c757d;
                margin-bottom: 6px;
                font-size: .9rem;
            }

            .price-new {
                color: #0d6efd;
                font-size: 1.1rem;
                font-weight: 700;
            }

            .book-card .book-title, .book-card .book-author {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            
            .btn-add-to-cart {
                background: #0d6efd;
                border-radius: 6px;
                padding: 8px;
                color: white;
                font-weight: 600;
                border: none;
                width: 100%;
            }

            .btn-add-to-cart:disabled {
                background: #999 !important;
                cursor: not-allowed;
            }

            .btn-view {
                border-radius: 6px;
                width: 100%;
            }

            /* === SIDEBAR CARD === */
            .enhanced-sidebar {
                background: #ffffff;
                padding: 22px;
                border-radius: 16px;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08);
                transition: .25s ease;
            }

            .enhanced-sidebar:hover {
                box-shadow: 0 10px 28px rgba(0,0,0,0.13);
            }

            /* Title */
            .filter-title {
                font-weight: 700;
                font-size: 1.2rem;
                color: #333;
            }

            /* === SIDEBAR INPUT === */
            .sidebar-input .input-group-text {
                border-radius: 10px 0 0 10px;
                background: #f3f4f6;
                border: 1px solid #ced4da;
            }

            .sidebar-input .form-control {
                border-radius: 0 10px 10px 0;
                padding: 10px;
                border: 1px solid #ced4da;
            }

            .sidebar-input .form-control:focus {
                border-color: #0d6efd !important;
                box-shadow: none !important;
            }

            /* === CATEGORY LIST === */
            .sidebar-list .sidebar-item {
                border: none !important;
                padding: 10px 14px;
                border-radius: 10px;
                font-size: 15px;
                font-weight: 500;
                margin-bottom: 3px;
                transition: .2s ease;
                color: #444;
            }

            .sidebar-item:hover {
                background: #eef3ff;
                color: #0d6efd;
            }

            .active-category {
                background: #0d6efd !important;
                color: #fff !important;
                border-radius: 10px;
            }

            /* Clear Filter Button */
            .clear-filter-btn {
                font-weight: 700;
                color: #dc3545 !important;
                text-decoration: none;
            }
            .clear-filter-btn:hover {
                text-decoration: underline;
            }

            #jakarta_faces_developmentstage_messages {
                display: none !important;
            }
            .small-btn {
                padding: 10px 22px !important;
                font-size: 15px !important;
                font-weight: 600 !important;
                border-radius: 6px !important;
            }


        </style>
    </h:head>

    <h:body>

        <!-- Header -->
        <div class="sticky-header-wrapper">
            <ui:include src="/header.xhtml"/>
        </div>

        <h:form>

            <!-- TOP SEARCH BAR -->
            <!-- SEARCH BAR -->
            <div class="container">
                <div class="search-container">

                    <div class="row g-3 align-items-end">

                        <div class="col-md-4">
                            <label class="fw-bold">Book Name</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="bi bi-book"></i>
                                </span>
                                <h:inputText value="#{bookBean.searchBookname}" styleClass="form-control"
                                           >
                        <f:passThroughAttribute name="placeholder" value="Search" />
                    </h:inputText>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <label class="fw-bold">Author</label>
                            <div class="input-group">
                                <span class="input-group-text bg-white">
                                    <i class="bi bi-person"></i>
                                </span>
                                <h:inputText value="#{bookBean.searchAuthor}" styleClass="form-control"
                                            >
                        <f:passThroughAttribute name="placeholder" value="Search" />
                    </h:inputText>
                            </div>
                        </div>

                        <div class="col-auto">
                            <h:commandLink action="#{bookBean.searchBooks}"
                                           styleClass="btn btn-primary small-btn d-inline-flex align-items-center">
                                <i class="bi bi-search me-1"></i>
                                <span>Search</span>
                            </h:commandLink>
                        </div>

                        <div class="col-auto">
                            <h:commandLink action="#{bookBean.clearSearch}"
                                           styleClass="btn btn-secondary small-btn d-inline-flex align-items-center">
                                <i class="bi bi-x-circle me-1"></i>
                                <span>Clear</span>
                            </h:commandLink>
                        </div>



                    </div>

                </div>
            </div>


            <div class="container-fluid mt-4">
                <div class="row">

                    <!-- LEFT SIDEBAR -->
                    <!-- LEFT SIDEBAR -->
                    <div class="col-lg-3 mb-4">
                        <div class="sidebar-card enhanced-sidebar sticky-top" style="top: 110px;">

                            <h4 class="filter-title mb-3">
                                <i class="bi bi-funnel-fill me-2"></i> Filters
                            </h4>

                            <!-- Search Category -->
                            <label class="fw-bold mb-1">Search Category</label>
                            <div class="input-group mb-3 sidebar-input">
                                <span class="input-group-text"><i class="bi bi-search"></i></span>
                                <h:inputText value="#{bookBean.searchBooktype}"
                                             styleClass="form-control"
                                             />
                            </div>

                            <h5 class="fw-bold mt-4 mb-2">Categories</h5>

                            <div class="list-group sidebar-list">

                                <h:commandLink action="#{bookBean.clearSearch}"
                                               styleClass="list-group-item sidebar-item active-category">
                                    <i class="bi bi-list me-2"></i> All Categories
                                </h:commandLink>

                                <ui:repeat value="#{bookBean.allBooktypes}" var="t">
                                    <h:commandLink styleClass="list-group-item sidebar-item"
                                                   action="#{bookBean.searchBooks}">
                                        <f:setPropertyActionListener target="#{bookBean.searchBooktype}" value="#{t.type}"/>
                                        <i class="bi bi-tag-fill me-2"></i> #{t.type}
                                    </h:commandLink>
                                </ui:repeat>

                            </div>

                            <h:commandLink value="Clear Filter"
                                           action="#{bookBean.clearSearch}"
                                           styleClass="clear-filter-btn mt-3"/>

                        </div>
                    </div>


                    <!-- BOOKS GRID -->
                    <div class="col-lg-9">

                        <!-- No books found -->
                        <h:panelGroup rendered="#{empty bookBean.allBooks}">
                            <div class="text-center py-5">
                                <img src="images/b2.png" style="width:180px; opacity:0.7;"/>
                                <h3 class="text-muted mt-3">No Books Found</h3>
                                <p class="text-secondary">Try using different search options.</p>
                            </div>
                        </h:panelGroup>

                        <!-- Books List -->
                        <div class="row g-4">
                            <ui:repeat value="#{bookBean.allBooks}" var="b">
                                <div class="col-sm-6 col-md-4 col-xl-3">
                                    <div class="book-card">

                                        <h:graphicImage value="/BookStore/BookStoreUploads/#{b.coverPhoto}"
                                                        rendered="#{not empty b.coverPhoto}"
                                                        styleClass="w-100"/>

                                        <div class="mt-2">
                                            <div class="book-title">#{b.bookname}</div>
                                            <div class="book-author">By <b>#{b.authorname}</b></div>

                                            <div class="d-flex justify-content-between mt-2">
                                                <span class="price-new">â‚¹#{b.price}</span>
                                                <span style="color:#{b.available>0?'green':'red'}; font-weight:600;">
                                                    #{b.available > 0 ? 'In Stock' : 'Out of Stock'}
                                                </span>
                                            </div>

                                            <div class="d-flex gap-2 mt-3">
                                                <h:commandButton value="Add to Cart"
                                                                 styleClass="btn-add-to-cart"
                                                                 action="#{cartBean.addToCart}"
                                                                 disabled="#{b.available == 0}">
                                                    <f:param name="bookId" value="#{b.id}"/>
                                                </h:commandButton>

                                                <h:commandButton value="View"
                                                                 styleClass="btn btn-outline-primary btn-view"
                                                                 action="#{bookBean.viewDetails}">
                                                    <f:param name="bookId" value="#{b.id}"/>
                                                </h:commandButton>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                        </div>

                    </div>
                </div>
            </div>

        </h:form>

    </h:body>
</html>
