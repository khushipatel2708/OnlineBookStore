<!-- AdminUserForm.xhtml -->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

<h:head>
    <title>Admin - User Form</title>

    <!-- Bootstrap & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
    <link rel="stylesheet" href="css/adminCss.css"/>
    <link rel="stylesheet" href="css/sidebar_header_css.css"/>

    <style>
        .form-card {
            background: #ffffff;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border: 1px solid #e9eef2;
        }
        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: #343a40;
        }
        .btn-save {
            background-color: #0d6efd;
            color: white;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 6px;
        }
        .btn-cancel {
            background-color: #6c757d;
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
        }
        .btn-back {
            background-color: #198754;
            color: white;
            padding: 8px 20px;
            border-radius: 6px;
        }
        .btn-change-password {
            background-color: #ffc107;
            color: black;
            padding: 6px 12px;
            border-radius: 6px;
            margin-left: 10px;
            font-weight: 600;
        }
    </style>
</h:head>

<h:body>

    <div class="sticky-header-wrapper">
        <ui:include src="/adminHeader.xhtml"/>
    </div>

    <div class="main-layout">
        <ui:include src="sidebar.xhtml"/>

        <div class="main-content">

            <h:form id="userForm">

                <!-- Page Title -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="page-title">
                        <h:outputText value="#{adminUserBean.editMode ? 'Edit User' : 'Add User'}"/>
                    </h2>
                </div>


                <!-- Form Card -->
                <div class="form-card">

                    <!-- Username -->
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <h:inputText value="#{adminUserBean.username}" 
                                     required="true"
                                     maxlength="100"
                                     styleClass="form-control">
                            <f:ajax event="blur" 
                                    listener="#{adminUserBean.checkUsernameUnique}" 
                                    render="usernameMsg"/>
                        </h:inputText>
                        <h:message id="usernameMsg" for="username" styleClass="text-danger"/>
                    </div>

                    <!-- Password + Change Password -->
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <div class="d-flex">

                            <h:inputSecret id="password"
                                           value="#{adminUserBean.password}"
                                           required="#{!adminUserBean.editMode}"
                                           maxlength="100"
                                           disabled="#{adminUserBean.passwordDisabled}"
                                           styleClass="form-control"/>

                            <!-- SHOW ONLY IN EDIT MODE -->
                            <h:commandButton value="Change Password"
                                             rendered="#{adminUserBean.editMode}"
                                             action="AdminChangePassword.xhtml?faces-redirect=true"
                                             styleClass="btn-change-password"
                                             style="margin-left:10px;"/>
                        </div>

                        <h:message for="password" styleClass="text-danger"/>
                    </div>

                    <!-- Full Name -->
                    <div class="mb-3">
                        <label class="form-label">Full Name</label>
                        <h:inputText value="#{adminUserBean.fullname}" 
                                     maxlength="200"
                                     styleClass="form-control"/>
                        <h:message for="fullname" styleClass="text-danger"/>
                    </div>

                    <!-- Email -->
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <h:inputText value="#{adminUserBean.email}"
                                     styleClass="form-control">
                            <f:ajax event="blur"
                                    listener="#{adminUserBean.checkEmailUnique}"
                                    render="emailMsg"/>
                        </h:inputText>
                        <h:message id="emailMsg" for="email" styleClass="text-danger"/>
                    </div>

                    <!-- Phone -->
                    <div class="mb-3">
                        <label class="form-label">Phone</label>
                        <h:inputText value="#{adminUserBean.phone}"
                                     styleClass="form-control">
                            <f:ajax event="blur"
                                    listener="#{adminUserBean.checkPhoneUnique}"
                                    render="phoneMsg"/>
                        </h:inputText>
                        <h:message id="phoneMsg" for="phone" styleClass="text-danger"/>
                    </div>

                    <!-- Group -->
                    <div class="mb-3">
                        <label class="form-label">Group</label>
                        <h:selectOneMenu value="#{adminUserBean.groupId}" styleClass="form-select">
                            <f:selectItem itemLabel="-- Select group --" itemValue="#{null}" />
                            <f:selectItems value="#{adminUserBean.allGroups}" var="g"
                                           itemValue="#{g.groupid}" itemLabel="#{g.groupname}" />
                        </h:selectOneMenu>
                    </div>

                    <!-- Active -->
                    <div class="mb-3 form-check">
                        <h:selectBooleanCheckbox value="#{adminUserBean.active}" 
                                                 styleClass="form-check-input"
                                                 id="active"/>
                        <label class="form-check-label" for="active">Active</label>
                    </div>

                    <!-- Buttons -->
                    <div class="mt-3">

                        <h:commandButton value="#{adminUserBean.editMode ? 'Update' : 'Save'}"
                                         action="#{adminUserBean.saveOrUpdate}"
                                         styleClass="btn-save"/>

                        <h:commandButton value="Cancel"
                                         action="#{adminUserBean.cancelEdit}"
                                         immediate="true"
                                         styleClass="btn-cancel ms-2"/>

                        <h:commandButton value="Back to List"
                                         action="AdminUserList.xhtml?faces-redirect=true"
                                         immediate="true"
                                         styleClass="btn-back ms-2"/>

                    </div>

                </div>

            </h:form>

        </div>

    </div>

</h:body>
</html>
    