<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <title>Order Confirmation</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>

        <style>
            body {
                background: #f2f4f7;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }
            .box {
                max-width: 720px;
                margin: 50px auto;
                padding: 30px 35px;
                border-radius: 15px;
                background: #ffffff;
                box-shadow: 0px 6px 20px rgba(0,0,0,0.12);
            }
            .title {
                text-align: center;
                font-size: 30px;
                font-weight: 700;
                margin-bottom: 30px;
                color: #333;
            }
            .table th, .table td {
                vertical-align: middle;
            }
            .table th {
                background-color: #f8f9fa;
                font-weight: 600;
            }
            .charges {
                font-size: 20px;
                text-align: right;
                margin-top: 20px;
            }
            .charges b {
                font-weight: 600;
            }
            .charges .total-amount {
                display: block;
                font-size: 22px;
                margin-top: 10px;
                color: #28a745;
                font-weight: 700;
            }
            .btn-row {
                display: flex;
                justify-content: space-between;
                gap: 10px;
                margin-top: 30px;
            }
            .pay-btn, .cod-btn {
                flex: 1;
                padding: 12px 0;
                font-size: 17px;
                font-weight: 600;
                border-radius: 8px;
                border: none;
                cursor: pointer;
                transition: all 0.3s ease;
            }
            .pay-btn {
                background-color: #28a745;
                color: #fff;
            }
            .pay-btn:hover {
                background-color: #218838;
            }
            .cod-btn {
                background-color: #ffc107;
                color: #212529;
            }
            .cod-btn:hover {
                background-color: #e0a800;
            }
        </style>
    </h:head>

    <h:body>
        <div class="sticky-header-wrapper">
            <ui:include src="/header.xhtml" /> 
        </div>

        <h:form id="cartForm">

            <div class="box">

                <div class="title">Confirm Your Order</div>

                <!-- Table -->
                <table class="table table-bordered text-center">
                    <thead>
                        <tr>
                            <th>Book Name</th>
                            <th>Total Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ui:repeat value="#{cartBean.cartItems}" var="c">
                            <tr>
                                <td>#{c.bookId.bookname}</td>
                                <td>₹#{c.bookId.price * c.quantity}</td>
                            </tr>
                        </ui:repeat>
                    </tbody>
                </table>

                <!-- Total Area -->
                <div class="charges">
                    Delivery Charge: <b>₹30</b>
                    <span class="total-amount">Total Amount: ₹#{cartBean.finalTotal}</span>
                </div>

                <!-- Buttons -->
                <div class="btn-row">
                    <!-- Online Payment -->
                    <h:commandButton value="Online Payment"
                                     styleClass="pay-btn"
                                     action="#{cartBean.goToPayment}" />

                    <!-- Cash on Delivery -->
                    <h:commandButton id="codBtn"
                                     value="Cash on Delivery"
                                     style="display:none;"
                                     action="#{cartBean.cashOnDelivery}" />
                    <button class="cod-btn" onclick="showCODConfirm(); return false;">
                        Cash on Delivery
                    </button>
                </div>

            </div>

        </h:form>

        <!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

        <script>
                            function showCODConfirm() {
                                Swal.fire({
                                    title: 'Are you sure?',
                                    text: 'Confirm Cash on Delivery?',
                                    icon: 'warning',
                                    showCancelButton: true,
                                    confirmButtonText: 'Yes',
                                    cancelButtonText: 'No'
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        var jsfBtn = document.getElementById('cartForm:codBtn');
                                        if (jsfBtn) {
                                            jsfBtn.click(); // perform the JSF action normally
                                        }
                                    }
                                });
                            }
        </script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    </h:body>
</html>
