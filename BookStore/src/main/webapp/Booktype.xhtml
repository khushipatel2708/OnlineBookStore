<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:f="jakarta.faces.core">

    <h:head>
        <title>Manage Book Types</title>

        <!-- Bootstrap & Icons -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
        <link rel="stylesheet"
              href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"/>
        <link rel="stylesheet" href="css/adminCss.css"/>
        <link rel="stylesheet" href="css/sidebar_header_css.css"/>

        <!-- SAME DESIGN AS CITY PAGE -->
        <style>
            .btn-add-booktype {
                background-color: #0d6efd;
                color: #fff;
                border-radius: 8px;
                border: none;
                padding: 10px 15px;
                font-weight: 600;
            }

            /* TABLE */
            .data-table-container {
                background: white;
                border-radius: 8px;
                border: 1px solid #e9eef2;
                box-shadow: 0 4px 10px rgba(0,0,0,0.05);
                overflow: hidden;
            }

            .booktype-table {
                width: 100%;
                border-collapse: collapse;
            }
            .booktype-table th {
                background: #f8f9fa;
                padding: 12px 15px;
                font-weight: 600;
                border-bottom: 1px solid #dee2e6;
            }
            .booktype-table td {
                padding: 12px 15px;
                border-bottom: 1px solid #eee;
            }

            .action-icon {
                padding: 5px 8px;
                border: 1px solid #ced4da;
                border-radius: 4px;
                cursor: pointer;
                margin-right: 5px;
            }
            .edit-icon {
                color: #0d6efd;
            }
            .delete-icon {
                color: #dc3545;
            }

        </style>
    </h:head>

    <h:body>

        <!-- Sticky Header -->
        <div class="sticky-header-wrapper">
            <ui:include src="/adminHeader.xhtml"/>
        </div>

        <div class="main-layout">

            <!-- SIDEBAR -->
            <ui:include src="sidebar.xhtml"/>

            <!-- MAIN CONTENT -->
            <div class="main-content">

                <h:panelGroup rendered="#{booktypeBean.admin}">

                    <h:form>

                        <div class="content-header">
                            <h2 class="page-title">Manage Book Types</h2>

                            <h:commandButton value="+ Add Book Type"
                                             action="#{booktypeBean.resetForm}"
                                             styleClass="btn-add-booktype">
                                <f:ajax render="booktypeModalForm"
                                        onevent="function(){
                                        new bootstrap.Modal(document.getElementById('booktypeModal')).show();
                                        }"/>
                            </h:commandButton>
                        </div>

                        <!-- TABLE -->
                        <div class="data-table-container">
                            <h:dataTable value="#{booktypeBean.pagedGroups}" var="bt"
                                         styleClass="booktype-table">

                                <h:column>
                                    <f:facet name="header">ID</f:facet>
                                        #{(booktypeBean.pageNumber - 1) * booktypeBean.pageSize + booktypeBean.pagedGroups.indexOf(bt) + 1}
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Type</f:facet>
                                        #{bt.type}
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Description</f:facet>
                                        #{bt.description}
                                </h:column>

                                <h:column>
                                    <f:facet name="header">Actions</f:facet>

                                    <!-- EDIT -->
                                    <h:commandButton value="âœ"
                                                     action="#{booktypeBean.editBooktype(bt.id)}"
                                                     styleClass="action-icon edit-icon"
                                                     title="Edit">
                                        <f:ajax execute="@this" render="booktypeModalForm"
                                                onevent="function(){
                                                new bootstrap.Modal(document.getElementById('booktypeModal')).show();
                                                }"/>
                                    </h:commandButton>

                                    <!-- DELETE -->
                                    <h:commandButton value="ðŸ—‘"
                                                     action="#{booktypeBean.deleteBooktype(bt.id)}"
                                                     onclick="return confirm('Delete this Book Type?')"
                                                     styleClass="action-icon delete-icon"
                                                     title="Delete">
                                        <f:ajax render="@form"/>
                                    </h:commandButton>

                                </h:column>

                            </h:dataTable>
                            <!-- Pagination Controls -->

                            <div class="pagination-container d-flex justify-content-center mt-4">

                                <ul class="premium-pagination">

                                    <!-- Previous -->
                                    <li class="#{booktypeBean.pageNumber == 1 ? 'disabled' : ''}">
                                        <h:commandLink action="#{booktypeBean.previousPage}">
                                            <f:ajax render="@form"/>
                                            <i class="bi bi-chevron-left"></i> 
                                        </h:commandLink>
                                    </li>

                                    <!-- Page Display -->
                                    <li class="active">
                                        <span>
                                            #{booktypeBean.pageNumber} / #{booktypeBean.totalPages}
                                        </span>
                                    </li>

                                    <!-- Next -->
                                    <li class="#{booktypeBean.pageNumber == booktypeBean.totalPages ? 'disabled' : ''}">
                                        <h:commandLink action="#{booktypeBean.nextPage}">
                                            <f:ajax render="@form"/>
                                            <i class="bi bi-chevron-right"></i>
                                        </h:commandLink>
                                    </li>

                                </ul>

                            </div>
                        </div>

                    </h:form>

                    <!-- MODAL -->
                    <div class="modal fade" id="booktypeModal">
                        <div class="modal-dialog">
                            <div class="modal-content">

                                <h:form id="booktypeModalForm">

                                    <div class="modal-header">
                                        <h5 class="modal-title">
                                            <h:panelGroup rendered="#{not booktypeBean.editMode}">
                                                Add Book Type
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{booktypeBean.editMode}">
                                                Edit Book Type (ID: #{booktypeBean.id})
                                            </h:panelGroup>
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" onclick="FixBackdrop()"></button>

                                    </div>

                                    <div class="modal-body">
                                        <label>Type:</label>
                                        <h:inputText value="#{booktypeBean.type}" styleClass="form-control" required="true"/>

                                        <br/>

                                        <label>Description:</label>
                                        <h:inputText value="#{booktypeBean.description}" styleClass="form-control"/>
                                    </div>

                                    <div class="modal-footer">

                                        <!-- ADD MODE -->
                                        <h:panelGroup rendered="#{not booktypeBean.editMode}">
                                            <h:commandButton value="Add" styleClass="btn btn-success"
                                                             action="#{booktypeBean.addBooktype}">
                                                <f:ajax execute="@form" render="booktypeModalForm"
                                                        onevent="function(){
                                                        bootstrap.Modal.getInstance(document.getElementById('booktypeModal')).hide();
                                                        }"/>
                                            </h:commandButton>

                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="FixBackdrop()">
                                                Cancel
                                            </button>
                                        </h:panelGroup>

                                        <!-- EDIT MODE -->
                                        <h:panelGroup rendered="#{booktypeBean.editMode}">
                                            <h:commandButton value="Update" styleClass="btn btn-primary"
                                                             action="#{booktypeBean.updateBooktype}">
                                                <f:ajax execute="@form" render="booktypeModalForm"
                                                        onevent="function(){
                                                        bootstrap.Modal.getInstance(document.getElementById('booktypeModal')).hide();
                                                        }"/>
                                            </h:commandButton>

                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" onclick="FixBackdrop()">
                                                Cancel
                                            </button>
                                        </h:panelGroup>

                                    </div>

                                </h:form>

                            </div>
                        </div>
                    </div>

                </h:panelGroup>

                <h:panelGroup rendered="#{not booktypeBean.admin}">
                    <div class="alert alert-danger">Only admin can manage book types.</div>
                </h:panelGroup>

            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    </h:body>
    <script>
                                        function FixBackdrop() {
                                            document.querySelectorAll('.modal-backdrop').forEach(b => b.remove());
                                            document.body.classList.remove('modal-open');
                                            document.body.style.removeProperty('overflow');
                                            document.body.style.removeProperty('padding-right');
                                        }
    </script>
</html>
