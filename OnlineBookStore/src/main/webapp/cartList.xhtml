<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>My Cart</title>
    <style>
        table { border-collapse: collapse; width: 80%; margin: 20px auto; }
        th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
        th { background-color: #f4f4f4; }
        .total { text-align: right; font-weight: bold; margin-right: 10%; }
        .qty-btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 3px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .qty-btn:hover { background-color: #0056b3; }
        .delete-btn { background-color: #d9534f; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; }
        .delete-btn:hover { background-color: #c9302c; }
    </style>
</h:head>

<h:body>
    <h:form id="cartForm">
        <h2 style="text-align:center;">My Cart</h2>

        <h:dataTable value="#{cartBean.cartItems}" var="c">
            <h:column>
                <f:facet name="header">Book Name</f:facet>
                #{c.book.bookname}
            </h:column>

            <h:column>
                <f:facet name="header">Price</f:facet>
                ₹#{c.book.price}
            </h:column>

            <!-- ✅ Quantity Column with + and - buttons -->
            <h:column>
                <f:facet name="header">Quantity</f:facet>
                <h:commandButton value="-" styleClass="qty-btn"
                                 action="#{cartBean.decreaseQuantity(c.id)}">
                    <f:ajax render="@form"/>
                </h:commandButton>
                <h:outputText value="#{c.quantity}" style="margin:0 10px;"/>
                <h:commandButton value="+" styleClass="qty-btn"
                                 action="#{cartBean.increaseQuantity(c.id)}">
                    <f:ajax render="@form"/>
                </h:commandButton>
            </h:column>

            <h:column>
                <f:facet name="header">Total</f:facet>
                ₹#{c.book.price * c.quantity}
            </h:column>

            <h:column>
                <f:facet name="header">Action</f:facet>
                <h:commandButton value="Delete" styleClass="delete-btn"
                                 action="#{cartBean.removeFromCart(c.id)}">
                    <f:ajax render="@form"/>
                </h:commandButton>
            </h:column>
        </h:dataTable>

        <h:panelGroup rendered="#{not empty cartBean.cartItems}">
            <h3 class="total">Grand Total: ₹#{cartBean.totalPrice}</h3>
        </h:panelGroup>

        <h:panelGroup rendered="#{empty cartBean.cartItems}">
            <p style="text-align:center;">Your cart is empty.</p>
        </h:panelGroup>
    </h:form>
</h:body>
</html>
